# ğŸ² Digital Dice Game â€“ Craps

**Final Project â€“ Digital Design**  
Bu-Ali Sina University, Computer Engineering Department (BASU)

![Craps Dice Game](pic/unnamed.jpg)

---

## Table of Contents

- [Overview](#-overview)
- [Game Rules](#-game-rules-craps--hardware-version)
- [Project Structure](#-project-structure)
- [Architecture](#-architecture)
- [Prerequisites](#-prerequisites)
- [Build & Simulation](#-build--simulation)
- [Collaborators](#-collaborators)
- [License & Academic Context](#-license--academic-context)
- [Acknowledgments](#-acknowledgments)
-
---

## âœ¨ Overview

This repository contains a **complete hardware implementation** of the classic **Craps** dice game, developed as the **digital logic design final project**. The system is implemented entirely in **VHDL** and is suitable for FPGA or simulation (e.g. GHDL).

The design follows the specification from the project document **â€œDESIGN OF A DICE GAME â€“ Digital Logic Design Project | Bu-Ali Sina â€“ 4041â€** and emphasizes:


- **FSM-based control** of the game flow  
- **Clear separation** between datapath, controller, and display logic  
- **Testbenches** for components and the full system  

Main building blocks:

- Two **pseudo-random dice counters**
- **Adder** and **comparator** for game rules  
- **Point register** to store the established point  
- **Controller FSM** (Moore-type) for game states and outputs  
- **7-segment decoders** and display gating so only â€œfinalâ€ results are shown when appropriate  

---

## ğŸ® Game Rules (Craps â€“ Hardware Version)

The system simulates rolling **two six-sided dice** and evaluates the **sum (2â€“12)** as follows.

### First roll (Come-out roll)

| Sum    | Result              |
|--------|---------------------|
| 7 or 11 | **Win** ğŸ‰         |
| 2, 3, 12 | **Lose** ğŸ’€        |
| 4, 5, 6, 8, 9, 10 | **Point** â€“ value stored for the next phase |

### Subsequent rolls (Point phase)

| Condition        | Result        |
|------------------|---------------|
| Sum = stored point | **Win** ğŸ¯   |
| Sum = 7          | **Lose** ğŸ’¥   |
| Otherwise        | Roll again ğŸ” |

### User interface

- **Reset** (active high): starts a new game and clears all state.  
- **Roll** (active high):  
  - **Pressed and held** â†’ dice counters run (values change).  
  - **Released** â†’ current dice values are captured and evaluated; win/lose/point is decided on the next clock edge.  

### Outputs

- **Two 7-segment displays**: one per die (values 1â€“6). They are **gated** so that numbers are shown only in specific FSM states (e.g. after evaluation, win, lose, or during reset), not while the dice are â€œrollingâ€.  
- **Two LEDs**: **Win** and **Lose**, driven by the controller FSM.  

---

## ğŸ“ Project Structure

```
vhdl_dice_project/
â”œâ”€â”€ README.md                 # This file
â”œâ”€â”€ run_sim.sh                # GHDL compile + run
â”œâ”€â”€ moduels/                  # VHDL source (note: directory name "moduels")
â”‚   â”œâ”€â”€ adder.vhd             # 3-bit + 3-bit â†’ 4-bit sum
â”‚   â”œâ”€â”€ comparator.vhd        # 4-bit equality (sum vs point)
â”‚   â”œâ”€â”€ dice_counter.vhd      #1â€“6 counter (one die)
â”‚   â”œâ”€â”€ register.vhd          # point_register (store point on Sp=1)
â”‚   â”œâ”€â”€ test_logic.vhd        # D7, D711, D2312 from sum
â”‚   â”œâ”€â”€ seven_seg2.vhd        # 7-segment decoder
â”‚   â”œâ”€â”€ controller_fsm.vhd     # Moore FSM: Roll, Sp, Win, Lose, Show
â”‚   â””â”€â”€ craps_system.vhd      # Top-level: wires all blocks + display gating
â”œâ”€â”€ testbenches/
â”‚   â”œâ”€â”€ tb_adder.vhd
â”‚   â”œâ”€â”€ tb_comparator.vhd
â”‚   â”œâ”€â”€ tb_dice_counter.vhd
â”‚   â”œâ”€â”€ tb_register.vhd
â”‚   â”œâ”€â”€ tb_test_logic.vhd
â”‚   â”œâ”€â”€ tb_seven_seg2.vhd
â”‚   â”œâ”€â”€ tb_controller_fsm.vhd
â”‚   â””â”€â”€ tb_craps_system.vhd   # Full system testbench
â”œâ”€â”€ work/                     # Generated by run_sim.sh (compile + VCD)
â”‚   â””â”€â”€ tb_craps_system.vcd   # Waveform (open with gtkwave)
â””â”€â”€ pic/
    â””â”€â”€ unnamed.jpg           # Project image
```

---

## ğŸ— Architecture

### Top-level (`craps_system`)

- **Inputs**: `clk`, `reset_btn`, `roll_btn`  
- **Outputs**: `seg_die1`, `seg_die2` (7-bit each), `win_led`, `lose_led`  

The top-level instantiates:

1. **Two `dice_counter`** instances (die1, die2) â€“ optionally with different clock/enable patterns for more varied rolls.  
2. **Adder** â€“ sum of the two 3-bit die values â†’ 4-bit sum (2â€“12).  
3. **`point_register`** â€“ stores the point when the FSM asserts `Sp` for one cycle.  
4. **Comparator** â€“ asserts `Eq` when sum equals stored point.  
5. **`test_logic`** â€“ combinational: `D7` (sum=7), `D711` (7 or 11), `D2312` (2, 3, or 12).  
6. **`controller_fsm`** â€“ Moore FSM; outputs: `Roll`, `Sp`, `Win`, `Lose`, and **`Show`** (used to gate the 7-segment displays).  
7. **Two `seven_seg`** decoders â€“ drive internal segment signals; outputs are gated by `Show`.  

### Controller FSM (Moore)

States: `reset_state`, `roll_come_out`, `eval_come_out`, `store_point`, `idle_point`, `roll_point`, `eval_point`, `win_state`, `lose_state`.

- **Roll**: asserted only in `roll_come_out` and `roll_point` (dice run while button is held).  
- **Sp**: one-cycle pulse in `store_point`.  
- **Win / Lose**: asserted in `win_state` / `lose_state`.  
- **Show**: asserted in `reset_state`, `eval_come_out`, `eval_point`, `win_state`, `lose_state` so the 7-segment displays show dice values only when appropriate (e.g. after evaluation or in terminal states), and stay blank while rolling or in `idle_point` / `store_point`.  

### Display gating

- When `Show = 0`: `seg_die1` and `seg_die2` are driven to all zeros (displays off).  
- When `Show = 1`: the decoded die values (1â€“6) are shown on the two 7-segment displays.  

This gives â€œfinal outputs onlyâ€ behavior: the player sees the dice numbers only when they are meaningful (e.g. after release or in win/lose).

---



## ğŸ“‹ Prerequisites

- **GHDL** â€“ VHDL analyzer and simulator ([ghdl.github.io](https://ghdl.github.io)).  
- **GTKWave** (optional) â€“ for viewing the generated VCD.  

On many Linux distributions:

```bash
# Example (adjust for your distro)
sudo apt install ghdl gtkwave   # Debian/Ubuntu
```

---

## ğŸ”§ Build & Simulation

### Quick run (recommended)

From the project root:

```bash
./run_sim.sh
```

This script:

1. Compiles all modules in `moduels/` in dependency order.  
2. Compiles the testbench set in the script (default: `tb_craps_system`).  
3. Elaborates the testbench entity.  
4. Runs the simulation and writes `work/tb_craps_system.vcd`.  
5. Opens GTKWave with the VCD if available.  

### Configuration

Edit the variables at the top of `run_sim.sh` to change testbench or run time:

- `TB_NAME` / `TB_ENTITY` â€“ testbench file and entity name.  
- `STOP_TIME` â€“ e.g. `800ns`.  
- `MODULES_DIR` â€“ default `moduels`.  
- `WORK_DIR` â€“ default `work`.  

### Manual GHDL commands (optional)

```bash
cd work
ghdl -a ../moduels/adder.vhd
ghdl -a ../moduels/comparator.vhd
ghdl -a ../moduels/dice_counter.vhd
ghdl -a ../moduels/register.vhd
ghdl -a ../moduels/test_logic.vhd
ghdl -a ../moduels/seven_seg2.vhd
ghdl -a ../moduels/controller_fsm.vhd
ghdl -a ../moduels/craps_system.vhd
ghdl -a ../testbenches/tb_craps_system.vhd
ghdl -e tb_craps_system
ghdl -r tb_craps_system --vcd=tb_craps_system.vcd --stop-time=800ns
gtkwave tb_craps_system.vcd
```

---

## ğŸ¤ Collaborators

- **Amin Rahimi mehrnia**  
  - GitHub: [aminrm4](https://github.com/aminrm4)  
  - Student ID: 40312358013  

- **Mohammad naseri**  
  - GitHub: [Naseri0017](https://github.com/Naseri0017)  
  - Student ID: 40312358043  

---

## ğŸ“œ License & Academic Context

- This project is the **final project for the Digital Design course** at **Bu-Ali Sina University**, Computer Engineering Department (BASU).  
- Instructor / reference: [SSCBasu](https://github.com/SSCBasu).  
- The VHDL code is for **educational and academic use**, following the specification adapted from the â€œFinal Project: Design of a Dice Gameâ€ (Dalhousie University) as cited in the project PDF.  

You may use and extend this design for **learning, teaching, and non-commercial academic work**, provided you keep the above credits and project context.

---

## ğŸ™ Acknowledgments

- Digital Design teaching team **(mahdi koushan mehr)** and TA group at BASU for guidance and feedback.  
- **TA head and course staff** for the project specification and support.  


---



Enjoy rolling the (digital) dice! ğŸ²âœ¨
